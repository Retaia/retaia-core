# yaml-language-server: $schema=../vendor/symfony/dependency-injection/Loader/schema/services.schema.json

# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.
# See also https://symfony.com/doc/current/service_container/import.html

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:
    app.password_reset_ttl_seconds: 3600
    app.email_verification_ttl_seconds: 86400
    app.email_verification.secret: '%kernel.secret%'
    app.password_policy.min_length: 12
    app.password_policy.require_mixed_case: true
    app.password_policy.require_number: true
    app.password_policy.require_special: true
    app.ingest.watch_path: '%env(string:APP_INGEST_WATCH_PATH)%'
    app.features.ai.suggest_tags: '%env(bool:APP_FEATURE_AI_SUGGEST_TAGS)%'
    app.features.ai.suggested_tags_filters: '%env(bool:APP_FEATURE_AI_SUGGESTED_TAGS_FILTERS)%'
    app.features.decisions.bulk: '%env(bool:APP_FEATURE_DECISIONS_BULK)%'
    app.feature_flags.contract.latest_version: '1.0.0'
    app.feature_flags.contract.accepted_versions: ['1.0.0', '0.9.0']

services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    App\:
        resource: '../src/'

    App\User\Repository\UserRepositoryInterface: '@App\User\Repository\UserRepository'
    App\User\Repository\PasswordResetTokenRepositoryInterface: '@App\User\Repository\PasswordResetTokenRepository'
    App\Asset\Repository\AssetRepositoryInterface: '@App\Asset\Repository\AssetRepository'
    App\Ingest\Port\FilePollerInterface: '@App\Ingest\Service\FilesystemFilePoller'
    App\Ingest\Port\ScanStateStoreInterface: '@App\Ingest\Repository\ScanStateStore'

    App\Controller\Api\AgentController:
        bind:
            bool $featureSuggestTagsEnabled: '%app.features.ai.suggest_tags%'
            bool $featureSuggestedTagsFiltersEnabled: '%app.features.ai.suggested_tags_filters%'
            bool $featureDecisionsBulkEnabled: '%app.features.decisions.bulk%'
            string $featureFlagsContractVersion: '%app.feature_flags.contract.latest_version%'
            array $acceptedFeatureFlagsContractVersions: '%app.feature_flags.contract.accepted_versions%'

    App\Controller\Api\WorkflowController:
        bind:
            bool $bulkDecisionsEnabled: '%app.features.decisions.bulk%'

    App\Controller\Api\AssetController:
        bind:
            bool $featureSuggestedTagsFiltersEnabled: '%app.features.ai.suggested_tags_filters%'

    App\Controller\Api\JobController:
        bind:
            bool $featureSuggestTagsEnabled: '%app.features.ai.suggest_tags%'

    # add more service definitions when explicit configuration is needed
    # please note that last definitions always *replace* previous ones
